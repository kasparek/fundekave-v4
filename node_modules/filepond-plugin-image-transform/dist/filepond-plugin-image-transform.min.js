/*
 * FilePondPluginImageTransform 2.1.0
 * Licensed under MIT, https://opensource.org/licenses/MIT
 * Please visit https://pqina.nl/filepond for details.
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.FilePondPluginImageTransform=e()}(this,function(){"use strict";var t=function(t){return/^image/.test(t.type)},e=function(t){if(Array.isArray(t)){for(var e=0,n=Array(t.length);e<t.length;e++)n[e]=t[e];return n}return Array.from(t)},n={1:function(){return[1,0,0,1,0,0]},2:function(t){return[-1,0,0,1,t,0]},3:function(t,e){return[-1,0,0,-1,t,e]},4:function(t,e){return[1,0,0,-1,0,e]},5:function(){return[0,1,1,0,0,0]},6:function(t,e){return[0,1,-1,0,e,0]},7:function(t,e){return[0,-1,-1,0,e,t]},8:function(t){return[0,-1,1,0,0,t]}},a=function(t,a,r,i){i!==-1&&t.transform.apply(t,e(n[i](a,r)))},r=function(t,e,n){e||(e={x:0,y:0,width:1,height:1});var r=document.createElement("canvas"),i=t.naturalWidth,o=t.naturalHeight;n>=5&&n<=8?(r.width=o,r.height=i):(r.width=i,r.height=o);var u=r.getContext("2d");u.save(),a(u,i,o,n),u.drawImage(t,0,0,i,o),u.restore();var h=u.getImageData(Math.round(e.x*r.width),Math.round(e.y*r.height),Math.round(e.width*r.width),Math.round(e.height*r.height));return h},i=function(t,e){return new Promise(function(n,a){var r=document.createElement("canvas");r.width=t.width,r.height=t.height;var i=r.getContext("2d");i.putImageData(t,0,0),r.toBlob(n,e.type,e.quality)})},o=function(t){var e=void 0;try{e=new ImageData(t.width,t.height)}catch(n){var a=document.createElement("canvas");e=a.getContext("2d").createImageData(t.width,t.height)}return e.data.set(t.data),e},u=function(){function t(t,e){var n=e.mode,a=e.upscale,r=e.size,i=r.width,o=r.height;if(null===i?i=o:null===o&&(o=i),"force"!==n){var u=i/t.width,h=o/t.height,l=1;if("cover"===n?l=Math.max(u,h):"contain"===n&&(l=Math.min(u,h)),l>1&&a===!1)return t;i=t.width*l,o=t.height*l}for(var g=t.width,d=t.height,c=Math.round(i),s=Math.round(o),f=t.data,m=new Uint8ClampedArray(c*s*4),v=g/c,p=d/s,y=Math.ceil(v/2),w=Math.ceil(p/2),M=0;M<s;M++)for(var T=0;T<c;T++){for(var x=4*(T+M*c),A=0,_=0,b=0,E=gx_g=gx_b=gx_a=0,R=(M+.5)*p,I=Math.floor(M*p);I<(M+1)*p;I++)for(var O=Math.abs(R-(I+.5))/w,U=(T+.5)*v,F=O*O,L=Math.floor(T*v);L<(T+1)*v;L++){var P=Math.abs(U-(L+.5))/y,B=Math.sqrt(F+P*P);B>=-1&&B<=1&&(A=2*B*B*B-3*B*B+1,A>0&&(P=4*(L+I*g),gx_a+=A*f[P+3],b+=A,f[P+3]<255&&(A=A*f[P+3]/250),E+=A*f[P],gx_g+=A*f[P+1],gx_b+=A*f[P+2],_+=A))}m[x]=E/_,m[x+1]=gx_g/_,m[x+2]=gx_b/_,m[x+3]=gx_a/b}return{data:m,width:c,height:s}}var e={resize:t},n=function(t,n){return t.forEach(function(t){n=e[t.type](n,t.data)}),n},a=function(t,e){var a=n(t.transforms,t.imageData);e(a)};self.onmessage=function(t){a(t.data.message,function(e){self.postMessage({id:t.data.id,message:e},[e.data.buffer])})}};HTMLCanvasElement.prototype.toBlob||Object.defineProperty(HTMLCanvasElement.prototype,"toBlob",{value:function(t,e,n){var a=this;setTimeout(function(){for(var r=a.toDataURL(e,n).split(",")[1],i=atob(r),o=i.length,u=new Uint8Array(o);o--;)u[o]=i.charCodeAt(o);t(new Blob([u],{type:e||"image/png"}))})}});var h=function(e){var n=e.addFilter,a=e.utils,h=a.Type,l=a.forin,g=a.loadImage,d=a.getFileFromBlob,c=a.getFilenameWithoutExtension,s=a.createWorker,f=a.createBlob,m=a.renameFile,v=a.isFile,p=function(t,e){var n=c(t),a="image/jpeg"===e?"jpg":e.split("/")[1];return n+"."+a},y=function(t){return"image/jpeg"===t||"image/png"===t?t:"image/jpeg"},w=["resize"];return n("PREPARE_OUTPUT",function(e,n){var a=n.query,h=n.item;return new Promise(function(n,c){if(!v(e)||!t(e)||!a("GET_ALLOW_IMAGE_TRANSFORM"))return n(e);var M=a("GET_IMAGE_TRANSFORM_OUTPUT_QUALITY"),T=null===M?null:M/100,x=a("GET_IMAGE_TRANSFORM_OUTPUT_QUALITY_MODE"),A=a("GET_IMAGE_TRANSFORM_OUTPUT_MIME_TYPE"),_=h.getMetadata(),b=_.crop,E=[];if(l(h.getMetadata(),function(t,e){w.includes(t)&&E.push({type:t,data:e})}),(null===T||null!==T&&"optional"===x)&&null===A&&!b&&!E.length)return n(e);var R=function(t,a){i(t,a).then(function(t){var a=d(t,p(e.name,y(t.type)));n(a)})["catch"](function(t){console.error(t)})},I=URL.createObjectURL(e);if(/svg/.test(e.type)&&null===A){if(!b)return n(e);var O=new FileReader;return O.onloadend=function(){var t=document.createElement("div");t.style.cssText="position:absolute;pointer-events:none;width:0;height:0;visibility:hidden;",t.innerHTML=O.result;var a=t.querySelector("svg");document.body.appendChild(t);var r=a.getBBox();t.parentNode.removeChild(t);var i=a.getAttribute("viewBox")||"",o=a.getAttribute("width")||"",u=a.getAttribute("height")||"",h=parseFloat(o)||null,l=parseFloat(u)||null,g=(o.match(/[a-z]+/)||[])[0]||"",d=(u.match(/[a-z]+/)||[])[0]||"";a.removeAttribute("width"),a.removeAttribute("height");var c=a.outerHTML,s=i.split(" ").map(parseFloat),v=s.length?{x:s[0],y:s[1],width:s[2],height:s[3]}:r;h||(h=v.width),l||(l=v.height);var p='width="'+h*b.rect.width+g+'"',y='height="'+l*b.rect.height+d+'"',w={x:h*-b.rect.x,y:l*-b.rect.y},M='<?xml version="1.0" encoding="UTF-8"?>\n<svg '+p+" "+y+' \n  viewBox="0 0 '+h+" "+l+'" \n  preserveAspectRatio="xMinYMin slice"\n  xmlns="http://www.w3.org/2000/svg">\n  <g transform="translate('+w.x+", "+w.y+')">\n    '+c+"\n  </g>\n</svg>";n(m(f(M,"image/svg+xml"),e.name))},void O.readAsText(e)}g(I).then(function(t){URL.revokeObjectURL(I);var n=(h.getMetadata("exif")||{}).orientation||-1,a=r(t,b?b.rect:null,n);if(!E.length)return void R(a,{quality:T,type:A||e.type});var i=s(u);i.post({transforms:E,imageData:a},function(t){R(o(t),{quality:T,type:A||e.type}),i.terminate()},[a.data.buffer])})})}),{options:{allowImageTransform:[!0,h.BOOLEAN],imageTransformOutputMimeType:[null,h.STRING],imageTransformOutputQuality:[null,h.INT],imageTransformOutputQualityMode:["always",h.STRING]}}};return"undefined"!=typeof navigator&&document&&document.dispatchEvent(new CustomEvent("FilePond:pluginloaded",{detail:h})),h});