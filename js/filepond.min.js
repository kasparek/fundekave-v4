$.getCSS=function(e){$("<link>").appendTo("head").attr({type:"text/css",rel:"stylesheet",href:e})};$.createScript=function(e){var f=document.getElementsByTagName("head")[0],a=document.createElement("script");a.src=e;var d=$.Deferred(),g=!1;a.onload=a.onreadystatechange=function(){g||this.readyState&&"loaded"!=this.readyState&&"complete"!=this.readyState||(g=!0,d.resolve(),a.onload=a.onreadystatechange=null)};f.appendChild(a);return d};
$.filepondLoad=function(e,f){var a=_fdk.cfg.jsUrl+"node_modules/";$.getCSS(a+"filepond/dist/filepond.css");var d="filepond/dist/filepond.js";f&&(d=d.replace(/(.js)$/gi,".min.js"));$.createScript((a||"")+d).done(function(){var d=[],b=$.map(e,function(c){switch(c){case "image-preview":$.getCSS(a+"filepond-plugin-"+c+"/dist/filepond-plugin-"+c+".css")}d.push("FilePondPlugin"+c.replace(/-/gi," ").replace(/\b\w/g,function(c){return c.toUpperCase()}).replace(/\s/g,""));c="filepond-plugin-"+c+"/dist/filepond-plugin-"+
c+".js";f&&(c=c.replace(/(.js)$/gi,".min.js"));return $.createScript((a||"")+c)});b.push($.Deferred(function(c){$(c.resolve)}));$.when.apply($,b).done(function(){for(var c in d)FilePond.registerPlugin(window[d[c]]);$(document).trigger("filepond-ready")})})};
$(function(){$.filepondLoad("file-validate-size file-validate-type image-transform image-resize image-preview file-encode image-exif-orientation".split(" "));$(document).on("filepond-ready",function(){var e=document.querySelector('input[type="file"]'),f=e.form,a={imageTransformOutputQuality:90,imagePreviewHeight:240,imageResizeUpscale:!1,imageResizeTargetWidth:2048,imageResizeTargetHeight:2048,imageResizeMode:"contain",imageTransformOutputQualityMode:"optional",instantUpload:!1},d=$(e).data();for(b in d)if(0===
b.indexOf("filepond")){var g=d[b];var b=b.substr(8);b=b.charAt(0).toLowerCase()+b.slice(1);a[b]=g}a.maxFiles&&1===a.maxFiles&&$(e).removeAttr("multiple");FilePond.setOptions({server:"fpapi/"});var c=FilePond.create(e,a);document.querySelector(".filepond--root").addEventListener("FilePond:processfile",function(a){if(!a.detail.error&&a.detail.file){var d=h(),b=a.detail.file;Fajax.add("file_id",b.serverId);$(document).one("Fajax:complete",function(a){setTimeout(function(){c.removeFile(b.id)},200);console.log(a.response);
0===d.length&&$(e).data("submit-after-upload")&&$("button[type=submit]",f).removeAttr("disabled").trigger("click").attr("disabled","disabled")});Fajax.send("page-fuup",_fdk.cfg.page)}});var h=function(){for(var a=c.getFiles(),d=[],b=a.length-1;0<=b;b--)5!=a[b].status&&0>d.indexOf(a[b].id)&&d.push(a[b].id);return d};$("button[type=submit]",f).on("click",function(){if(0===c.getFiles().length)return 0<$(e).data("min-files")?(alert("Please, insert some images."),!1):!0;var a=h();if(0<a.length){$(this).attr("disabled",
"disabled");for(var b=a.length-1;0<=b;b--)c.processFile(a[b]).then(function(a){});return!1}return!0})})});