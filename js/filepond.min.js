$.getCSS=function(c){$("<link>").appendTo("head").attr({type:"text/css",rel:"stylesheet",href:c})};$.createScript=function(c){var d=document.getElementsByTagName("head")[0],b=document.createElement("script");b.src=c;var f=$.Deferred(),e=!1;b.onload=b.onreadystatechange=function(){e||this.readyState&&"loaded"!=this.readyState&&"complete"!=this.readyState||(e=!0,f.resolve(),b.onload=b.onreadystatechange=null)};d.appendChild(b);return f};
$.filepondLoad=function(c,d){$.getCSS("node_modules/filepond/dist/filepond.css");var b="filepond/dist/filepond.js";d&&(b=b.replace(/(.js)$/gi,".min.js"));$.createScript("node_modules/"+b).done(function(){var b=[],e=$.map(c,function(a){switch(a){case "image-preview":$.getCSS("node_modules/filepond-plugin-"+a+"/dist/filepond-plugin-"+a+".css")}b.push("FilePondPlugin"+a.replace(/-/gi," ").replace(/\b\w/g,function(a){return a.toUpperCase()}).replace(/\s/g,""));a="filepond-plugin-"+a+"/dist/filepond-plugin-"+
a+".js";d&&(a=a.replace(/(.js)$/gi,".min.js"));return $.createScript("node_modules/"+a)});e.push($.Deferred(function(a){$(a.resolve)}));$.when.apply($,e).done(function(){for(var a in b)FilePond.registerPlugin(window[b[a]]);$(document).trigger("filepond-ready")})})};
$(function(){$.filepondLoad("file-validate-size file-validate-type image-transform image-resize image-preview file-encode image-exif-orientation".split(" "));$(document).on("filepond-ready",function(){var c=document.querySelector('input[type="file"]'),d=c.form,b={imageTransformOutputQuality:90,imagePreviewHeight:240,imageResizeUpscale:!1,imageResizeTargetWidth:2048,imageResizeTargetHeight:2048,imageResizeMode:"contain",imageTransformOutputQualityMode:"optional",instantUpload:!1},f=$(c).data();for(a in f)if(0===
a.indexOf("filepond")){var e=f[a];var a=a.substr(8);a=a.charAt(0).toLowerCase()+a.slice(1);b[a]=e}b.maxFiles&&1===b.maxFiles&&$(c).removeAttr("multiple");FilePond.setOptions({server:"fpapi/"});var g=FilePond.create(c,b);document.querySelector(".filepond--root").addEventListener("FilePond:processfile",function(a){if(!a.detail.error&&a.detail.file){var b=h(),k=a.detail.file;Fajax.add("file_id",k.serverId);$(document).one("Fajax:complete",function(a){setTimeout(function(){g.removeFile(k.id)},200);console.log(a.response);
0===b.length&&$(c).data("submit-after-upload")&&$("button[type=submit]",d).removeAttr("disabled").trigger("click").attr("disabled","disabled")});Fajax.send("page-fuup",_fdk.cfg.page)}});var h=function(){for(var a=g.getFiles(),b=[],c=a.length-1;0<=c;c--)5!=a[c].status&&0>b.indexOf(a[c].id)&&b.push(a[c].id);return b};$("button[type=submit]",d).on("click",function(){if(0===g.getFiles().length)return 0<$(c).data("min-files")?(alert("Please, insert some images."),!1):!0;var a=h();if(0<a.length){$(this).attr("disabled",
"disabled");for(var b=a.length-1;0<=b;b--)g.processFile(a[b]).then(function(a){});return!1}return!0})})});