function MarkerClusterer(c,d,e){this.extend(MarkerClusterer,google.maps.OverlayView);this.map_=c;this.markers_=[];this.clusters_=[];this.sizes=[53,56,66,78,90];this.styles_=[];this.ready_=false;var f=e||{};this.gridSize_=f['gridSize']||60;this.maxZoom_=f['maxZoom']||null;this.styles_=f['styles']||[];this.imagePath_=f['imagePath']||this.MARKER_CLUSTER_IMAGE_PATH_;this.imageExtension_=f['imageExtension']||this.MARKER_CLUSTER_IMAGE_EXTENSION_;this.zoomOnClick_=f['zoomOnClick']||true;this.minimumClusterSize=f['minimumClusterSize']||1;this.setupStyles_();this.setMap(c);this.prevZoom_=this.map_.getZoom();this.drawnZoomed=false;var g=this;google.maps.event.addListener(this.map_,'zoom_changed',function(){var a=g.maxZoom_?g.maxZoom_:g.map_.mapTypes[g.map_.getMapTypeId()].maxZoom;var b=g.map_.getZoom();if(b<0||(b>a&&g.drawnZoomed)){return}if(g.prevZoom_!=b){g.prevZoom_=g.map_.getZoom();g.drawnZoomed=b>a;g.resetViewport()}});google.maps.event.addListener(this.map_,'idle',function(){g.redraw()});if(d&&d.length){this.addMarkers(d,false)}}MarkerClusterer.prototype.MARKER_CLUSTER_IMAGE_PATH_=Sett.jsUrl+'markerclusterer/images/m';MarkerClusterer.prototype.MARKER_CLUSTER_IMAGE_EXTENSION_='png';MarkerClusterer.prototype.extend=function(b,c){return(function(a){for(property in a.prototype){this.prototype[property]=a.prototype[property]}return this}).apply(b,[c])};MarkerClusterer.prototype.onAdd=function(){this.setReady_(true)};MarkerClusterer.prototype.idle=function(){};MarkerClusterer.prototype.draw=function(){};MarkerClusterer.prototype.setupStyles_=function(){for(var i=0,size;size=this.sizes[i];i++){this.styles_.push({url:this.imagePath_+(i+1)+'.'+this.imageExtension_,height:size,width:size})}};MarkerClusterer.prototype.setStyles=function(a){this.styles_=a};MarkerClusterer.prototype.getStyles=function(){return this.styles_};MarkerClusterer.prototype.isZoomOnClick=function(){return this.zoomOnClick_};MarkerClusterer.prototype.getMarkers=function(){return this.markers_};MarkerClusterer.prototype.getTotalMarkers=function(){return this.markers_};MarkerClusterer.prototype.setMaxZoom=function(a){this.maxZoom_=a};MarkerClusterer.prototype.getMaxZoom=function(){return this.maxZoom_||this.map_.mapTypes[this.map_.getMapTypeId()].maxZoom};MarkerClusterer.prototype.calculator_=function(a,b){var c=0;var d=a.length;var e=d;while(e!==0){e=parseInt(e/10,10);c++}c=Math.min(c,b);return{text:d,index:c}};MarkerClusterer.prototype.setCalculator=function(a){this.calculator_=a};MarkerClusterer.prototype.getCalculator=function(){return this.calculator_};MarkerClusterer.prototype.addMarkers=function(a,b){for(var i=0,marker;marker=a[i];i++){this.pushMarkerTo_(marker)}if(!b){this.redraw()}};MarkerClusterer.prototype.pushMarkerTo_=function(a){a.setVisible(false);a.setMap(null);a.isAdded=false;if(a['draggable']){var b=this;google.maps.event.addListener(a,'dragend',function(){a.isAdded=false;b.resetViewport();b.redraw()})}this.markers_.push(a)};MarkerClusterer.prototype.addMarker=function(a,b){this.pushMarkerTo_(a);if(!b){this.redraw()}};MarkerClusterer.prototype.removeMarker=function(a){var b=-1;if(this.markers_.indexOf){b=this.markers_.indexOf(a)}else{for(var i=0,m;m=this.markers_[i];i++){if(m==a){b=i;continue}}}if(b==-1){return false}this.markers_.splice(b,1);a.setVisible(false);a.setMap(null);this.resetViewport();this.redraw();return true};MarkerClusterer.prototype.setReady_=function(a){if(!this.ready_){this.ready_=a;this.createClusters_()}};MarkerClusterer.prototype.getTotalClusters=function(){return this.clusters_.length};MarkerClusterer.prototype.getMap=function(){return this.map_};MarkerClusterer.prototype.setMap=function(a){this.map_=a};MarkerClusterer.prototype.getGridSize=function(){return this.gridSize_};MarkerClusterer.prototype.setGridSize=function(a){this.gridSize_=a};MarkerClusterer.prototype.getExtendedBounds=function(a){var b=this.getProjection();var c=new google.maps.LatLng(a.getNorthEast().lat(),a.getNorthEast().lng());var d=new google.maps.LatLng(a.getSouthWest().lat(),a.getSouthWest().lng());var e=b.fromLatLngToDivPixel(c);e.x+=this.gridSize_;e.y-=this.gridSize_;var f=b.fromLatLngToDivPixel(d);f.x-=this.gridSize_;f.y+=this.gridSize_;var g=b.fromDivPixelToLatLng(e);var h=b.fromDivPixelToLatLng(f);a.extend(g);a.extend(h);return a};MarkerClusterer.prototype.isMarkerInBounds_=function(a,b){return b.contains(a.getPosition())};MarkerClusterer.prototype.clearMarkers=function(){this.resetViewport();this.markers_=[]};MarkerClusterer.prototype.resetViewport=function(){for(var i=0,cluster;cluster=this.clusters_[i];i++){cluster.remove()}for(var i=0,marker;marker=this.markers_[i];i++){marker.isAdded=false;marker.setMap(null);marker.setVisible(false)}this.clusters_=[]};MarkerClusterer.prototype.redraw=function(){this.createClusters_()};MarkerClusterer.prototype.createClusters_=function(){if(!this.ready_){return}var a=new google.maps.LatLngBounds(this.map_.getBounds().getSouthWest(),this.map_.getBounds().getNorthEast());var b=this.getExtendedBounds(a);for(var i=0,marker;marker=this.markers_[i];i++){var c=false;if(!marker.isAdded&&this.isMarkerInBounds_(marker,b)){for(var j=0,d;d=this.clusters_[j];j++){if(!c&&d.getCenter()&&d.isMarkerInClusterBounds(marker)){c=true;d.addMarker(marker);break}}if(!c){var d=new Cluster(this);d.addMarker(marker);this.clusters_.push(d)}}}};function Cluster(a){this.markerClusterer_=a;this.map_=a.getMap();this.gridSize_=a.getGridSize();this.minimumSize=a.minimumClusterSize;this.center_=null;this.markers_=[];this.bounds_=null;this.clusterIcon_=new ClusterIcon(this,a.getStyles(),a.getGridSize())}Cluster.prototype.isMarkerAlreadyAdded=function(a){if(this.markers_.indexOf){return this.markers_.indexOf(a)!=-1}else{for(var i=0,m;m=this.markers_[i];i++){if(m==a){return true}}}return false};Cluster.prototype.addMarker=function(a){if(this.isMarkerAlreadyAdded(a)){return false}if(!this.center_){this.center_=a.getPosition();this.calculateBounds_()}if(this.markers_.length<this.minimumSize){a.setMap(this.map_);a.setVisible(true)}else if(this.markers_.length==this.minimumSize){for(var i=0;i<this.markers_.length;i++){this.markers_[i].setMap(null);this.markers_[i].setVisible(false)}}a.isAdded=true;this.markers_.push(a);this.updateIcon();return true};Cluster.prototype.getMarkerClusterer=function(){return this.markerClusterer_};Cluster.prototype.getBounds=function(){this.calculateBounds_();return this.bounds_};Cluster.prototype.remove=function(){this.clusterIcon_.remove();delete this.markers_};Cluster.prototype.getCenter=function(){return this.center_};Cluster.prototype.calculateBounds_=function(){var a=new google.maps.LatLngBounds(this.center_,this.center_);this.bounds_=this.markerClusterer_.getExtendedBounds(a)};Cluster.prototype.isMarkerInClusterBounds=function(a){return this.bounds_.contains(a.getPosition())};Cluster.prototype.getMap=function(){return this.map_};Cluster.prototype.updateIcon=function(){var a=this.map_.getZoom();var b=this.markerClusterer_.getMaxZoom();if(a>b){for(var i=0,marker;marker=this.markers_[i];i++){marker.setMap(this.map_);marker.setVisible(true)}return}if(this.markers_.length<=this.minimumSize){this.clusterIcon_.hide();return}var c=this.markerClusterer_.getStyles().length;var d=this.markerClusterer_.getCalculator()(this.markers_,c);this.clusterIcon_.setCenter(this.center_);this.clusterIcon_.setSums(d);this.clusterIcon_.show()};function ClusterIcon(a,b,c){a.getMarkerClusterer().extend(ClusterIcon,google.maps.OverlayView);this.styles_=b;this.padding_=c||0;this.cluster_=a;this.center_=null;this.map_=a.getMap();this.div_=null;this.sums_=null;this.visible_=false;this.setMap(this.map_)}ClusterIcon.prototype.triggerClusterClick=function(){var a=this.cluster_.getMarkerClusterer();google.maps.event.trigger(a,'clusterclick',[this.cluster_]);if(a.isZoomOnClick()){this.map_.panTo(this.cluster_.getCenter());this.map_.fitBounds(this.cluster_.getBounds())}};ClusterIcon.prototype.onAdd=function(){this.div_=document.createElement('DIV');if(this.visible_){var a=this.getPosFromLatLng_(this.center_);this.div_.style.cssText=this.createCss(a);this.div_.innerHTML=this.sums_.text}var b=this.getPanes();b.overlayImage.appendChild(this.div_);var c=this;google.maps.event.addDomListener(this.div_,'click',function(){c.triggerClusterClick()})};ClusterIcon.prototype.getPosFromLatLng_=function(a){var b=this.getProjection().fromLatLngToDivPixel(a);b.x-=parseInt(this.width_/2,10);b.y-=parseInt(this.height_/2,10);return b};ClusterIcon.prototype.draw=function(){if(this.visible_){var a=this.getPosFromLatLng_(this.center_);this.div_.style.top=a.y+'px';this.div_.style.left=a.x+'px'}};ClusterIcon.prototype.hide=function(){if(this.div_){this.div_.style.display='none'}this.visible_=false};ClusterIcon.prototype.show=function(){if(this.div_){var a=this.getPosFromLatLng_(this.center_);this.div_.style.cssText=this.createCss(a);this.div_.style.display=''}this.visible_=true};ClusterIcon.prototype.remove=function(){this.setMap(null)};ClusterIcon.prototype.onRemove=function(){if(this.div_&&this.div_.parentNode){this.hide();this.div_.parentNode.removeChild(this.div_);this.div_=null}};ClusterIcon.prototype.setSums=function(a){this.sums_=a;this.text_=a.text;this.index_=a.index;if(this.div_){this.div_.innerHTML=a.text}this.useStyle()};ClusterIcon.prototype.useStyle=function(){var a=Math.max(0,this.sums_.index-1);a=Math.min(this.styles_.length-1,a);var b=this.styles_[a];this.url_=b.url;this.height_=b.height;this.width_=b.width;this.textColor_=b.opt_textColor;this.anchor=b.opt_anchor;this.textSize_=b.opt_textSize};ClusterIcon.prototype.setCenter=function(a){this.center_=a};ClusterIcon.prototype.createCss=function(a){var b=[];if(document.all){b.push('filter:progid:DXImageTransform.Microsoft.AlphaImageLoader('+'sizingMethod=scale,src="'+this.url_+'");')}else{b.push('background:url('+this.url_+');')}if(typeof this.anchor_==='object'){if(typeof this.anchor_[0]==='number'&&this.anchor_[0]>0&&this.anchor_[0]<this.height_){b.push('height:'+(this.height_-this.anchor_[0])+'px; padding-top:'+this.anchor_[0]+'px;')}else{b.push('height:'+this.height_+'px; line-height:'+this.height_+'px;')}if(typeof this.anchor_[1]==='number'&&this.anchor_[1]>0&&this.anchor_[1]<this.width_){b.push('width:'+(this.width_-this.anchor_[1])+'px; padding-left:'+this.anchor_[1]+'px;')}else{b.push('width:'+this.width_+'px; text-align:center;')}}else{b.push('height:'+this.height_+'px; line-height:'+this.height_+'px; width:'+this.width_+'px; text-align:center;')}var c=this.textColor_?this.textColor_:'black';var d=this.textSize_?this.textSize_:11;b.push('cursor:pointer; top:'+a.y+'px; left:'+a.x+'px; color:'+c+'; position:absolute; font-size:'+d+'px; font-family:Arial,sans-serif; font-weight:bold');return b.join('')};