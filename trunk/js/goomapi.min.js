function MarkerClusterer(a,c,b){this.extend(MarkerClusterer,google.maps.OverlayView);c=c||[];b=b||{};this.markers_=[];this.clusters_=[];this.listeners_=[];this.activeMap_=null;this.ready_=!1;this.gridSize_=b.gridSize||60;this.minClusterSize_=b.minimumClusterSize||2;this.maxZoom_=b.maxZoom||null;this.styles_=b.styles||[];this.title_=b.title||"";this.zoomOnClick_=!0;void 0!==b.zoomOnClick&&(this.zoomOnClick_=b.zoomOnClick);this.averageCenter_=!1;void 0!==b.averageCenter&&(this.averageCenter_=b.averageCenter);
this.ignoreHidden_=!1;void 0!==b.ignoreHidden&&(this.ignoreHidden_=b.ignoreHidden);this.printable_=!1;void 0!==b.printable&&(this.printable_=b.printable);this.imagePath_=b.imagePath||MarkerClusterer.IMAGE_PATH;this.imageExtension_=b.imageExtension||MarkerClusterer.IMAGE_EXTENSION;this.imageSizes_=b.imageSizes||MarkerClusterer.IMAGE_SIZES;this.calculator_=b.calculator||MarkerClusterer.CALCULATOR;this.batchSize_=b.batchSize||MarkerClusterer.BATCH_SIZE;this.batchSizeIE_=b.batchSizeIE||MarkerClusterer.BATCH_SIZE_IE;
-1!==navigator.userAgent.toLowerCase().indexOf("msie")&&(this.batchSize_=this.batchSizeIE_);this.setupStyles_();this.addMarkers(c,!0);this.setMap(a)}function Cluster(a){this.markerClusterer_=a;this.map_=a.getMap();this.gridSize_=a.getGridSize();this.minClusterSize_=a.getMinimumClusterSize();this.averageCenter_=a.getAverageCenter();this.printable_=a.getPrintable();this.markers_=[];this.bounds_=this.center_=null;this.clusterIcon_=new ClusterIcon(this,a.getStyles())}
function ClusterIcon(a,c){a.getMarkerClusterer().extend(ClusterIcon,google.maps.OverlayView);this.cluster_=a;this.styles_=c;this.sums_=this.div_=this.center_=null;this.visible_=!1;this.setMap(a.getMap())}
ClusterIcon.prototype.onAdd=function(){var a=this,c,b;this.div_=document.createElement("div");this.visible_&&this.show();this.getPanes().overlayMouseTarget.appendChild(this.div_);google.maps.event.addListener(this.getMap(),"bounds_changed",function(){b=c});google.maps.event.addDomListener(this.div_,"mousedown",function(){c=!0;b=!1});google.maps.event.addDomListener(this.div_,"click",function(e){c=!1;if(!b){var d,f=a.cluster_.getMarkerClusterer();google.maps.event.trigger(f,"click",a.cluster_);google.maps.event.trigger(f,
"clusterclick",a.cluster_);f.getZoomOnClick()&&(d=f.getMaxZoom(),f.getMap().fitBounds(a.cluster_.getBounds()),null!==d&&f.getMap().getZoom()>d&&f.getMap().setZoom(d+1));e.cancelBubble=!0;e.stopPropagation&&e.stopPropagation()}});google.maps.event.addDomListener(this.div_,"mouseover",function(){var b=a.cluster_.getMarkerClusterer();google.maps.event.trigger(b,"mouseover",a.cluster_)});google.maps.event.addDomListener(this.div_,"mouseout",function(){var b=a.cluster_.getMarkerClusterer();google.maps.event.trigger(b,
"mouseout",a.cluster_)})};ClusterIcon.prototype.onRemove=function(){this.div_&&this.div_.parentNode&&(this.hide(),google.maps.event.clearInstanceListeners(this.div_),this.div_.parentNode.removeChild(this.div_),this.div_=null)};ClusterIcon.prototype.draw=function(){if(this.visible_){var a=this.getPosFromLatLng_(this.center_);this.div_.style.top=a.y+"px";this.div_.style.left=a.x+"px"}};ClusterIcon.prototype.hide=function(){this.div_&&(this.div_.style.display="none");this.visible_=!1};
ClusterIcon.prototype.show=function(){if(this.div_){var a=this.getPosFromLatLng_(this.center_);this.div_.style.cssText=this.createCss(a);this.div_.innerHTML=this.cluster_.printable_?"<img src='"+this.url_+"'><div style='position: absolute; top: 0px; left: 0px; width: "+this.width_+"px;'>"+this.sums_.text+"</div>":this.sums_.text;this.div_.title=this.cluster_.getMarkerClusterer().getTitle();this.div_.style.display=""}this.visible_=!0};
ClusterIcon.prototype.useStyle=function(a){this.sums_=a;a=Math.max(0,a.index-1);a=Math.min(this.styles_.length-1,a);a=this.styles_[a];this.url_=a.url;this.height_=a.height;this.width_=a.width;this.anchor_=a.anchor;this.anchorIcon_=a.anchorIcon||[parseInt(this.height_/2,10),parseInt(this.width_/2,10)];this.textColor_=a.textColor||"black";this.textSize_=a.textSize||11;this.textDecoration_=a.textDecoration||"none";this.fontWeight_=a.fontWeight||"bold";this.fontStyle_=a.fontStyle||"normal";this.fontFamily_=
a.fontFamily||"Arial,sans-serif";this.backgroundPosition_=a.backgroundPosition||"0 0"};ClusterIcon.prototype.setCenter=function(a){this.center_=a};
ClusterIcon.prototype.createCss=function(a){var c=[];this.cluster_.printable_||(c.push("background-image:url("+this.url_+");"),c.push("background-position:"+this.backgroundPosition_+";"));"object"===typeof this.anchor_?("number"===typeof this.anchor_[0]&&0<this.anchor_[0]&&this.anchor_[0]<this.height_?c.push("height:"+(this.height_-this.anchor_[0])+"px; padding-top:"+this.anchor_[0]+"px;"):c.push("height:"+this.height_+"px; line-height:"+this.height_+"px;"),"number"===typeof this.anchor_[1]&&0<this.anchor_[1]&&
this.anchor_[1]<this.width_?c.push("width:"+(this.width_-this.anchor_[1])+"px; padding-left:"+this.anchor_[1]+"px;"):c.push("width:"+this.width_+"px; text-align:center;")):c.push("height:"+this.height_+"px; line-height:"+this.height_+"px; width:"+this.width_+"px; text-align:center;");c.push("cursor:pointer; top:"+a.y+"px; left:"+a.x+"px; color:"+this.textColor_+"; position:absolute; font-size:"+this.textSize_+"px; font-family:"+this.fontFamily_+"; font-weight:"+this.fontWeight_+"; font-style:"+this.fontStyle_+
"; text-decoration:"+this.textDecoration_+";");return c.join("")};ClusterIcon.prototype.getPosFromLatLng_=function(a){a=this.getProjection().fromLatLngToDivPixel(a);a.x-=this.anchorIcon_[1];a.y-=this.anchorIcon_[0];return a};Cluster.prototype.getSize=function(){return this.markers_.length};Cluster.prototype.getMarkers=function(){return this.markers_};Cluster.prototype.getCenter=function(){return this.center_};Cluster.prototype.getMap=function(){return this.map_};
Cluster.prototype.getMarkerClusterer=function(){return this.markerClusterer_};Cluster.prototype.getBounds=function(){var a,c=new google.maps.LatLngBounds(this.center_,this.center_),b=this.getMarkers();for(a=0;a<b.length;a++)c.extend(b[a].getPosition());return c};Cluster.prototype.remove=function(){this.clusterIcon_.setMap(null);this.markers_=[];delete this.markers_};
Cluster.prototype.addMarker=function(a){var c,b;if(this.isMarkerAlreadyAdded_(a))return!1;this.center_?this.averageCenter_&&(b=this.markers_.length+1,c=(this.center_.lat()*(b-1)+a.getPosition().lat())/b,b=(this.center_.lng()*(b-1)+a.getPosition().lng())/b,this.center_=new google.maps.LatLng(c,b),this.calculateBounds_()):(this.center_=a.getPosition(),this.calculateBounds_());a.isAdded=!0;this.markers_.push(a);c=this.markers_.length;b=this.markerClusterer_.getMaxZoom();if(null!==b&&this.map_.getZoom()>
b)a.getMap()!==this.map_&&a.setMap(this.map_);else if(c<this.minClusterSize_)a.getMap()!==this.map_&&a.setMap(this.map_);else if(c===this.minClusterSize_)for(a=0;a<c;a++)this.markers_[a].setMap(null);else a.setMap(null);this.updateIcon_();return!0};Cluster.prototype.isMarkerInClusterBounds=function(a){return this.bounds_.contains(a.getPosition())};Cluster.prototype.calculateBounds_=function(){var a=new google.maps.LatLngBounds(this.center_,this.center_);this.bounds_=this.markerClusterer_.getExtendedBounds(a)};
Cluster.prototype.updateIcon_=function(){var a=this.markers_.length,c=this.markerClusterer_.getMaxZoom();null!==c&&this.map_.getZoom()>c?this.clusterIcon_.hide():a<this.minClusterSize_?this.clusterIcon_.hide():(a=this.markerClusterer_.getStyles().length,a=this.markerClusterer_.getCalculator()(this.markers_,a),this.clusterIcon_.setCenter(this.center_),this.clusterIcon_.useStyle(a),this.clusterIcon_.show())};
Cluster.prototype.isMarkerAlreadyAdded_=function(a){var c;if(this.markers_.indexOf)return-1!==this.markers_.indexOf(a);for(c=0;c<this.markers_.length;c++)if(a===this.markers_[c])return!0;return!1};
MarkerClusterer.prototype.onAdd=function(){var a=this;this.activeMap_=this.getMap();this.ready_=!0;this.repaint();this.listeners_=[google.maps.event.addListener(this.getMap(),"zoom_changed",function(){a.resetViewport_(!1);0===this.getZoom()&&google.maps.event.trigger(this,"idle")}),google.maps.event.addListener(this.getMap(),"idle",function(){a.redraw_()})]};
MarkerClusterer.prototype.onRemove=function(){var a;for(a=0;a<this.markers_.length;a++)this.markers_[a].setMap(this.activeMap_);for(a=0;a<this.clusters_.length;a++)this.clusters_[a].remove();this.clusters_=[];for(a=0;a<this.listeners_.length;a++)google.maps.event.removeListener(this.listeners_[a]);this.listeners_=[];this.activeMap_=null;this.ready_=!1};MarkerClusterer.prototype.draw=function(){};
MarkerClusterer.prototype.setupStyles_=function(){var a,c;if(!(0<this.styles_.length))for(a=0;a<this.imageSizes_.length;a++)c=this.imageSizes_[a],this.styles_.push({url:this.imagePath_+(a+1)+"."+this.imageExtension_,height:c,width:c})};MarkerClusterer.prototype.fitMapToMarkers=function(){var a,c=this.getMarkers(),b=new google.maps.LatLngBounds;for(a=0;a<c.length;a++)b.extend(c[a].getPosition());this.getMap().fitBounds(b)};MarkerClusterer.prototype.getGridSize=function(){return this.gridSize_};
MarkerClusterer.prototype.setGridSize=function(a){this.gridSize_=a};MarkerClusterer.prototype.getMinimumClusterSize=function(){return this.minClusterSize_};MarkerClusterer.prototype.setMinimumClusterSize=function(a){this.minClusterSize_=a};MarkerClusterer.prototype.getMaxZoom=function(){return this.maxZoom_};MarkerClusterer.prototype.setMaxZoom=function(a){this.maxZoom_=a};MarkerClusterer.prototype.getStyles=function(){return this.styles_};
MarkerClusterer.prototype.setStyles=function(a){this.styles_=a};MarkerClusterer.prototype.getTitle=function(){return this.title_};MarkerClusterer.prototype.setTitle=function(a){this.title_=a};MarkerClusterer.prototype.getZoomOnClick=function(){return this.zoomOnClick_};MarkerClusterer.prototype.setZoomOnClick=function(a){this.zoomOnClick_=a};MarkerClusterer.prototype.getAverageCenter=function(){return this.averageCenter_};
MarkerClusterer.prototype.setAverageCenter=function(a){this.averageCenter_=a};MarkerClusterer.prototype.getIgnoreHidden=function(){return this.ignoreHidden_};MarkerClusterer.prototype.setIgnoreHidden=function(a){this.ignoreHidden_=a};MarkerClusterer.prototype.getImageExtension=function(){return this.imageExtension_};MarkerClusterer.prototype.setImageExtension=function(a){this.imageExtension_=a};MarkerClusterer.prototype.getImagePath=function(){return this.imagePath_};
MarkerClusterer.prototype.setImagePath=function(a){this.imagePath_=a};MarkerClusterer.prototype.getImageSizes=function(){return this.imageSizes_};MarkerClusterer.prototype.setImageSizes=function(a){this.imageSizes_=a};MarkerClusterer.prototype.getCalculator=function(){return this.calculator_};MarkerClusterer.prototype.setCalculator=function(a){this.calculator_=a};MarkerClusterer.prototype.getPrintable=function(){return this.printable_};
MarkerClusterer.prototype.setPrintable=function(a){this.printable_=a};MarkerClusterer.prototype.getBatchSizeIE=function(){return this.batchSizeIE_};MarkerClusterer.prototype.setBatchSizeIE=function(a){this.batchSizeIE_=a};MarkerClusterer.prototype.getMarkers=function(){return this.markers_};MarkerClusterer.prototype.getTotalMarkers=function(){return this.markers_.length};MarkerClusterer.prototype.getClusters=function(){return this.clusters_};MarkerClusterer.prototype.getTotalClusters=function(){return this.clusters_.length};
MarkerClusterer.prototype.addMarker=function(a,c){this.pushMarkerTo_(a);c||this.redraw_()};MarkerClusterer.prototype.addMarkers=function(a,c){var b;for(b=0;b<a.length;b++)this.pushMarkerTo_(a[b]);c||this.redraw_()};MarkerClusterer.prototype.pushMarkerTo_=function(a){if(a.getDraggable()){var c=this;google.maps.event.addListener(a,"dragend",function(){c.ready_&&(this.isAdded=!1,c.repaint())})}a.isAdded=!1;this.markers_.push(a)};
MarkerClusterer.prototype.removeMarker=function(a,c){var b=this.removeMarker_(a);!c&&b&&this.repaint();return b};MarkerClusterer.prototype.removeMarkers=function(a,c){var b,e,d=!1;for(b=0;b<a.length;b++)e=this.removeMarker_(a[b]),d=d||e;!c&&d&&this.repaint();return d};
MarkerClusterer.prototype.removeMarker_=function(a){var c,b=-1;if(this.markers_.indexOf)b=this.markers_.indexOf(a);else for(c=0;c<this.markers_.length;c++)if(a===this.markers_[c]){b=c;break}if(-1===b)return!1;a.setMap(null);this.markers_.splice(b,1);return!0};MarkerClusterer.prototype.clearMarkers=function(){this.resetViewport_(!0);this.markers_=[]};
MarkerClusterer.prototype.repaint=function(){var a=this.clusters_.slice();this.clusters_=[];this.resetViewport_(!1);this.redraw_();setTimeout(function(){var c;for(c=0;c<a.length;c++)a[c].remove()},0)};
MarkerClusterer.prototype.getExtendedBounds=function(a){var c=this.getProjection(),b=new google.maps.LatLng(a.getNorthEast().lat(),a.getNorthEast().lng()),e=new google.maps.LatLng(a.getSouthWest().lat(),a.getSouthWest().lng()),b=c.fromLatLngToDivPixel(b);b.x+=this.gridSize_;b.y-=this.gridSize_;e=c.fromLatLngToDivPixel(e);e.x-=this.gridSize_;e.y+=this.gridSize_;b=c.fromDivPixelToLatLng(b);c=c.fromDivPixelToLatLng(e);a.extend(b);a.extend(c);return a};MarkerClusterer.prototype.redraw_=function(){this.createClusters_(0)};
MarkerClusterer.prototype.resetViewport_=function(a){var c,b;for(c=0;c<this.clusters_.length;c++)this.clusters_[c].remove();this.clusters_=[];for(c=0;c<this.markers_.length;c++)b=this.markers_[c],b.isAdded=!1,a&&b.setMap(null)};
MarkerClusterer.prototype.distanceBetweenPoints_=function(a,c){var b=(c.lat()-a.lat())*Math.PI/180,e=(c.lng()-a.lng())*Math.PI/180,b=Math.sin(b/2)*Math.sin(b/2)+Math.cos(a.lat()*Math.PI/180)*Math.cos(c.lat()*Math.PI/180)*Math.sin(e/2)*Math.sin(e/2);return 12742*Math.atan2(Math.sqrt(b),Math.sqrt(1-b))};MarkerClusterer.prototype.isMarkerInBounds_=function(a,c){return c.contains(a.getPosition())};
MarkerClusterer.prototype.addToClosestCluster_=function(a){var c,b,e,d=4E4,f=null;for(c=0;c<this.clusters_.length;c++)if(e=this.clusters_[c],b=e.getCenter())b=this.distanceBetweenPoints_(b,a.getPosition()),b<d&&(d=b,f=e);f&&f.isMarkerInClusterBounds(a)?f.addMarker(a):(e=new Cluster(this),e.addMarker(a),this.clusters_.push(e))};
MarkerClusterer.prototype.createClusters_=function(a){var c,b,e=this;if(this.ready_){0===a&&(google.maps.event.trigger(this,"clusteringbegin",this),"undefined"!==typeof this.timerRefStatic&&(clearTimeout(this.timerRefStatic),delete this.timerRefStatic));b=3<this.getMap().getZoom()?new google.maps.LatLngBounds(this.getMap().getBounds().getSouthWest(),this.getMap().getBounds().getNorthEast()):new google.maps.LatLngBounds(new google.maps.LatLng(85.02070771743472,-178.48388434375),new google.maps.LatLng(-85.08136444384544,
178.00048865625));b=this.getExtendedBounds(b);for(var d=Math.min(a+this.batchSize_,this.markers_.length);a<d;a++)c=this.markers_[a],!c.isAdded&&this.isMarkerInBounds_(c,b)&&(!this.ignoreHidden_||this.ignoreHidden_&&c.getVisible())&&this.addToClosestCluster_(c);d<this.markers_.length?this.timerRefStatic=setTimeout(function(){e.createClusters_(d)},0):(delete this.timerRefStatic,google.maps.event.trigger(this,"clusteringend",this))}};
MarkerClusterer.prototype.extend=function(a,c){return function(a){for(var c in a.prototype)this.prototype[c]=a.prototype[c];return this}.apply(a,[c])};MarkerClusterer.CALCULATOR=function(a,c){for(var b=0,e=a.length.toString(),d=e;0!==d;)d=parseInt(d/10,10),b++;b=Math.min(b,c);return{text:e,index:b}};MarkerClusterer.BATCH_SIZE=2E3;MarkerClusterer.BATCH_SIZE_IE=500;MarkerClusterer.IMAGE_PATH="http://google-maps-utility-library-v3.googlecode.com/svn/trunk/markerclustererplus/images/m";
MarkerClusterer.IMAGE_EXTENSION="png";MarkerClusterer.IMAGE_SIZES=[53,56,66,78,90];
var GooMapi=new function(){var a=this;a.icons={sail:"http://fundekave.net/css01/images/sailing.png",blue:"http://maps.google.com/mapfiles/ms/icons/blue-dot.png",red:"http://maps.google.com/mapfiles/ms/icons/red-dot.png"};a.uid=function(){a.uidc++;return"goomapi"+a.uidc.toString(16)};a.uidc=0;a.li={};a.poLi={};a.popid=null;a.info=null;a.unitR=3440;a.unit="NM";a.units=[{id:"nm",n:"NM",R:3440},{id:"km",n:"Km",R:6371}];a.setUnitHandler=function(c){for(c=0;c<a.units.length;c++)if($(this).attr("rel")==
a.units[c].id)return a.setUnit(a.units[c].n,a.units[c].R,this.data.id),!1};a.setUnit=function(c,b,e){a.unitR=b;a.unit=c;e&&a.editorData(e).updateDistance()};a.distance=function(c,b,e,d){var f=Math.PI/180,g=(e-c)*f;b=(d-b)*f;c=Math.sin(g/2)*Math.sin(g/2)+Math.cos(c*f)*Math.cos(e*f)*Math.sin(b/2)*Math.sin(b/2);c=2*Math.atan2(Math.sqrt(c),Math.sqrt(1-c));return a.unitR*c};a.posFormat=function(a){var b=parseFloat(a);if(isNaN(b)||0==b)return 0;a=$.trim(a);b=a.charAt(a.length-1).toUpperCase();if("W"==b||
"E"==b||"N"==b||"S"==b)a=a.substr(0,a.length-1).split(" "),a=("W"==b||"S"==b?-1:1)*(a[0]-0+((1<a.length?a[1]-0:0)+(2<a.length?a[2]-0:0)/60)/60);return a-0};a.parsePos=function(c){c=$.trim(c);var b=[];if(!c)return b;if(0<c.length){c=c.split("\n");for(i=0;i<c.length;i++)c[i]=c[i].split(","),2==c[i].length?(c[i][0]=a.posFormat(c[i][0]),c[i][1]=a.posFormat(c[i][1]),0==c[i][0]&&0==c[i][1]&&(c[i]=!1)):c[i]=!1;for(i=0;i<c.length;i++)!1!==c[i]&&b.push(c[i])}return b};a.cfg={};a.lng={};a.loading=!1;a.loaded=
!1;a.call=[];a.load=function(c){if(a.loaded)return!0;-1==indexOf(a.call,c)&&a.call.push(c);a.loading||(a.loading=!0,LazyLoad.js("http://maps.google.com/maps/api/js?v=3&sensor=false&libraries=geometry&callback=GooMapi.c"))};a.c=function(){a.loading=!1;for(a.loaded=!0;0<a.call.length;)a.call.shift()()};a.sourceTOut=null;a.sourceT=1E3;a.sourceTF=function(a){$("."+$(a).attr("class").replace("ThumbA","")+"Source").show()};a.sourceOver=function(c){a.sourceTOut=setTimeout(a.sourceTF,a.sourceT,this)};a.sourceOut=
function(){clearTimeout(a.sourceTOut)};a.init=function(c,b){a.cfg=c;a.lng=b;$(".geoInput").each(function(){var b=$(this).attr("id"),c=$(this).width(),f=$(this).height();b||(b=a.uid(),$(this).attr("id",b));$(this).is("textarea")?($thumbs=$("."+b+"Thumb"),0==$thumbs.length&&($(this).change(a.staticSel).hide().after('<a href="#" class="'+b+'ThumbA" title="Show route"><img class="'+b+'Thumb" src="" width="'+c+'" height="'+f+'" alt="Google Maps" /></a><a href="#" class="'+b+'Source" title="Source waypoints"><img src="'+
a.cfg.cssUrl+'/images/source.png" alt="Waypoints source" /></a>'),$("."+b+"Source").click(function(){clearTimeout(a.sourceTOut);$("#"+$(this).attr("class").replace("Source","")).toggle().change();return!1}).hide(),$("."+b+"Thumb").click(function(){a.geoInputClick(null,$(this).attr("class").replace("Thumb",""))}),$("."+b+"ThumbA").hover(a.sourceOver,a.sourceOut).click(function(){return!1}))):$(this).unbind("click",a.geoInputClick).click(a.geoInputClick)}).change();$(".mapLarge").each(function(){var b=
$(this).attr("id");b||(b=a.uid(),$(this).attr("id",b));if(!$(this).hasClass("hidden")&&0==$("map"+b+"holder",this).length)if($(this).hasClass("editor")){var c=a.editorData(b,this),f=$(this).attr("rel");f&&(c.dataEl=document.getElementById(f));c.parent.pop=!1;a.mapEditor(b)}else a.show(b)});listen("mapThumbLink","click",a.thumbClick)};a.thumbClick=function(){var c=$(this).attr("id").replace("Thumb","");$(this).remove();$("#"+c).removeClass("hidden");a.show(c)};a.geoInputClick=function(c,b){c&&(b=$(this).attr("id"));
a.popid&&a.close();var e=a.editorData();e.dataEl=null;if(b){var d=document.getElementById(b);d&&$(d).is("textarea")&&(e.dataEl=d)}e.dataEl?$(e.parent.eli.mapSaveB).show():$(e.parent.eli.mapSaveB).hide();a.mapEditor("Editor");return!1};a.staticSel=function(c){var b=a.parsePos($(this).val());c=$(this).attr("id");var e=$(this).width(),d=$(this).height();if(!d||32>d)d=Math.round(0.75*e),$(this).height(d);b="http://maps.google.com/maps/api/staticmap?size="+e+"x"+d+(0<b.length?"&markers="+b[b.length-1]:
"&zoom=3&center=51.477222,0&maptype=terrain")+"&sensor=false"+(1<b.length?"&path="+b.join("|"):"");$("."+c+"Thumb").css("width",e+"px").css("height",d+"px").attr("src",b);$(this).is(":visible")?$("."+c+"Thumb").hide():$("."+c+"Thumb").show()};a.editorData=function(c,b){c||(c="Editor");if(a.li[c])return $(a.li[c].eli.mainEl).show(),a.li[c].li[0];var e="border: 1px solid #707070;background-color:#d0d0d0;",e=b?e+"position:relative;width:100%;height:100%;":e+"position:fixed;z-index:10000;";$(b?b:"body").append('<div style="'+
e+'" id="map'+c+'Overlay"><div style="position:absolute;width:100%;height:20px;background-color:#e78f08;color:#ffffff;font-weight: bold;font-family: Trebuchet MS,Tahoma,Verdana,Arial,sans-serif;font-size:11px;"><div style="padding:0 10px;line-height:20px;">'+(b?"":'<a id="mapCloseB" href="#" role="button" style="display:block;float:right;color:#ffffff;">'+a.lng.close+"</a>")+'<span class="mapTitle">'+a.lng.title+'</span> <span class="mapUnitsBox"><a class="mapUnitNM" href="#" rel="nm" style="color:#ffffff;" title="'+
a.lng.unitTitle+'">NM</a> <a class="mapUnitKm" href="#" rel="km" style="color:#ffffff;" title="'+a.lng.unitTitle+'">Km</a></span></div></div><div class="map"></div><div style="bottom:2px;left:5px;position:absolute;"><input class="mapSearchI" value="" style="width:200px;"/><button class="mapSearchB" style="">'+a.lng.search+'</button></div><div style="bottom:2px;right:5px;position:absolute;"><button class="mapClearB" title="'+a.lng.clearTitle+'">'+a.lng.clear+'</button><button class="mapSaveB" title="'+
a.lng.saveTitle+'">'+a.lng.save+"</button></div></div>");var e=document.getElementById("map"+c+"Overlay"),d=new a.hold($(".map",e)[0]);d.id=c;d.editor=!0;d.eli.mainEl=e;d.eli.mapUnitsBox=$(".mapUnitsBox",e)[0];$(d.eli.mapUnitsBox).hide();d.eli.mapUnitBLi=[$(".mapUnitNM",e)[0],$(".mapUnitKm",e)[0]];for(var f=0;f<d.eli.mapUnitBLi.length;f++)d.eli.mapUnitBLi[f].data=d,$(d.eli.mapUnitBLi[f]).click(a.setUnitHandler);d.eli.mapSearchI=$(".mapSearchI",e)[0];d.eli.mapSearchI.data=d;d.eli.mapSearchB=$(".mapSearchB",
e)[0];d.eli.mapSearchB.data=d;$(d.eli.mapSearchB).click(a.search);$(d.eli.mapSearchI).keydown(a.searchKey);d.eli.mapTitle=$(".mapTitle",e)[0];b?d.pop=!1:(a.popid=c,d.eli.mapCloseB=document.getElementById("mapCloseB"),d.eli.mapCloseB.data=d,$(d.eli.mapCloseB).click(a.close));d.eli.mapClearB=$(".mapClearB",e)[0];d.eli.mapClearB.data=d;$(d.eli.mapClearB).click(a.clear);d.eli.mapSaveB=$(".mapSaveB",e)[0];d.eli.mapSaveB.data=d;$(d.eli.mapSaveB).click(a.save);d.li=[new a.data(d)];a.li[c]=d;a.resize();return d.li[0]};
a.hold=function(a){var b=this;b.eli={};b.li=[];b.pop=!0;b.editor=!1;b.mapType="terrain";b.map=null;b.geocoder=null;b.cluster=null;b.mapEl=a;b.id=null;b.init=function(){b.map||(b.geocoder=new google.maps.Geocoder,b.map=new google.maps.Map(b.mapEl,{mapTypeId:b.mapType}),b.map.data=b,b.map.setCenter(new google.maps.LatLng(30,35)),b.map.setZoom(2),b.editor||(b.cluster=new MarkerClusterer(b.map,[],{maxZoom:10,zoomOnClick:!0})))}};a.data=function(c){var b=this;b.pathColor="#0000ff";b.strokeWeight=4;b.pathAlpha=
"0.5";b.parent=c;b.dataEl=null;b.title="";b.infoEl=null;b.ico=null;b.markers=[];b.path=null;b.distance=0;b.addListeners=function(){if(b.parent.editor){var c=google.maps.event;c.clearListeners(b.parent.map,"click");c.addListener(b.parent.map,"click",a.editorClick);if(0!=b.markers.length){c.clearListeners(b.path);c.addListener(b.path,"click",function(a){for(var b=999,c,e=this.data.markers,d=0;d<e.length-1;d++){var f=e[d],p=e[d+1],f=Math.abs(google.maps.geometry.spherical.computeDistanceBetween(f.getPosition(),
p.getPosition())-(google.maps.geometry.spherical.computeDistanceBetween(a.latLng,f.getPosition())+google.maps.geometry.spherical.computeDistanceBetween(a.latLng,p.getPosition())));f<b&&(b=f,c=d)}e.splice(c+1,0,null);this.getPath().insertAt(c+1,a.latLng);this.data.updateMarker(a.latLng,c+1);this.data.updateDistance()});for(var d=0;d<b.markers.length;d++){var f=b.markers[d];c.clearListeners(f);c.addListener(f,"drag",function(){this.data.path.getPath().setAt(indexOf(this.data.markers,this),this.getPosition())});
c.addListener(f,"dragend",function(){this.data.path.getPath().setAt(indexOf(this.data.markers,this),this.getPosition());this.data.updateDistance()});c.addListener(f,"dblclick",function(){var a=indexOf(this.data.markers,this);this.data.path.getPath().removeAt(a);this.data.markers.splice(a,1);this.setMap(null);this.data.updateDistance();this.data=null})}}}};b.updateMarker=function(c,d){var f=b.markers.length;"undefined"==typeof d?d=0<f?f-1:0:d>f&&(d=f);if(!b.markers[d]){b.markers[d]=new google.maps.Marker(b.parent.editor?
{title:b.title,draggable:!0,raiseOnDrag:!1}:{title:b.title});var g=b.markers[d];g.data=b;b.parent.editor&&(b.addListeners(),g.setTitle(a.lng.markerTitle));b.parent.cluster&&b.parent.cluster.addMarker(g)}b.ico&&(g.setIcon(a.icons[b.ico]?a.icons[b.ico]:b.ico),g.setZIndex(1));g.setPosition(c);g.setMap(b.parent.map);b.infoEl&&0<b.infoEl.length&&(g.htmlInfo=$(b.infoEl).html());$(b.infoEl).hide()};b.resetWP=function(){for(b.path&&b.path.setPath([]);0<b.markers.length;)b.markers.pop().setMap(null)};b.addWP=
function(a,c){b.path||(b.path=new google.maps.Polyline({map:b.parent.map,path:[],strokeColor:b.pathColor,strokeOpacity:b.pathAlpha,strokeWeight:b.strokeWeight,geodesic:!0}),b.path.data=b);b.path.setMap(b.parent.map);b.path.getPath().push(a);c&&b.updateMarker(a,b.markers.length)};b.updateDistance=function(){b.distance=0;if(b.path){var c=b.path.getPath();if(1<c.length)for(i=1;i<c.length;i++)b.distance+=a.distance(c.getAt(i-1).lat(),c.getAt(i-1).lng(),c.getAt(i).lat(),c.getAt(i).lng());b.distance=Math.round(10*
b.distance)/10;b.parent.editor&&($(b.parent.eli.mapTitle).html(0<b.distance?a.lng.distance+b.distance+a.unit:a.lng.title),0<b.distance?$(b.parent.eli.mapUnitsBox).show():$(b.parent.eli.mapUnitsBox).hide())}};b.get=function(){return b.dataEl?a.parsePos($(b.dataEl).val()):[]}};a.showQueue=[];a.show=function(c,b){c&&a.showQueue.push({id:c,f:b});if(a.load(a.show)&&0!=a.showQueue.length)for(;0<a.showQueue.length;){var e=a.showQueue.pop();c=e.id;b=e.f;if(!a.li[c]){e=document.getElementById(c);if(!e)break;
$(e).append('<div id="map'+c+'holder" style="width:100%;height:'+$(e).height()+'px;"></div>');a.li[c]=new a.hold(document.getElementById("map"+c+"holder"));a.li[c].id=c;a.li[c].init();$(".mapsData",e).each(function(){var b=new a.data(a.li[c]);b.dataEl=$(".geoData",this);0<$(".pathColor",this).length&&(b.pathColor=$(".pathColor",this).val());0<$(".strokeWeight",this).length&&(b.strokeWeight=$(".strokeWeight",this).val());b.title=$(b.dataEl).attr("title");b.infoEl=$(".geoInfo",this);b.ico=$(".geoIco",
this).val();a.li[c].li.push(b)})}for(var e=a.li[c],d=new google.maps.LatLngBounds,f=0;f<e.li.length;f++){var g=e.li[f],h=g.get(),l=h.length;g.resetWP();if(0<l){po=Math.round(1E3*h[l-1][0])+","+Math.round(1E3*h[l-1][1]);if(a.poLi[po]){var m=Math.ceil(a.poLi[po]/4),n=4-(4*m-a.poLi[po]);1==n?h[l-1][0]+=1E-4*m:2==n?h[l-1][1]+=2E-4*m:3==n?h[l-1][0]-=1E-4*m:h[l-1][1]-=2E-4*m;a.poLi[po]++}else a.poLi[po]=1;for(m=0;m<l;m++)n=new google.maps.LatLng(h[m][0],h[m][1]),g.addWP(n,g.parent.editor||m==l-1),d.extend(n);
g.updateDistance()}l=g.markers.length;!g.parent.editor&&0<l&&(h=g.markers[l-1],google.maps.event.clearListeners(h),0<g.infoEl.length&&(h.htmlInfo=h.htmlInfo.replace("[[DISTANCE]]",g.distance),google.maps.event.addListener(h,"click",function(b){a.info||(a.info=new google.maps.InfoWindow({maxWidth:300}));a.info.setContent(this.htmlInfo);a.info.open(this.getMap(),this)})))}d.isEmpty()||(a.fit.push({m:e.map,b:d}),setTimeout(a.fitLater,100));$(window).unbind("resize",a.mapResize).resize(a.mapResize).resize();
$.isFunction(b)&&b(c)}};a.mapEditorQueue=[];a.mapEditor=function(c){c&&-1==indexOf(a.mapEditorQueue,c)&&a.mapEditorQueue.push(c);if(a.load(a.mapEditor)&&0!=a.mapEditorQueue.length)for(;0<a.mapEditorQueue.length;)c=a.mapEditorQueue.pop(),a.editorData(c).parent.init(),a.show(c,function(b){b=a.editorData(b);b.dataEl?$(b.parent.eli.mapSaveB).show():$(b.parent.eli.mapSaveB).hide();b.addListeners();b.updateDistance();b.parent.pop&&($(window).resize(a.resize).resize(),$(window).keydown(a.wkey))})};a.fit=
[];a.fitLater=function(){for(;0<a.fit.length;){var c=a.fit.pop();c.m.fitBounds(c.b)}};a.resize=function(c){var b=$(window).width(),e=$(window).height();c=0.9*b;var d=0.9*e,b=(b-c)/2,e=(e-d)/2;for(k in a.li)a.li[k].pop&&$("#map"+a.li[k].id+"Overlay").css("width",c+"px").css("height",d+"px").css("left",b+"px").css("top",e+"px")};a.mapResize=function(){for(k in a.li)a.li[k].editor&&$(a.li[k].mapEl).css("width","100%").css("position","absolute").css("top","20px").css("bottom","30px"),a.li[k].map&&google.maps.event.trigger(a.li[k].map,
"resize")};a.editorClick=function(c){var b=a.editorData(c.id?c.id:this.data.id),e=b.path?b.path.getPath():null,d=!0,f=0;e&&(f=e.getLength());0<f&&e.getAt(f-1).lat()==c.latLng.lat()&&e.getAt(f-1).lng()==c.latLng.lng()&&(d=!1);d&&b.addWP(c.latLng,!0);b.updateDistance()};a.close=function(c){c=a.editorData(a.popid);$(c.parent.eli.mainEl).hide();$(window).unbind("resize",a.resize);$(window).unbind("keydown",a.wkey);a.popid=null;return!1};a.save=function(c){c=a.editorData(this.data.id);if(c.dataEl){var b=
$(c.dataEl).val(),e=a.toString(this.data.id);$(c.dataEl).val(e);b!=e&&$(c.dataEl).change()}a.close()};a.toString=function(c){c=a.editorData(c);var b="";if(c.path){var e=[];c.path.getPath().forEach(function(a){e.push(a.toUrlValue(4))});b=e.join("\n")}return b};a.clear=function(c){c=a.editorData(this.data.id);c.resetWP();c.updateDistance();$(c.parent.eli.mapTitle).html(a.lng.title)};a.wkey=function(c){27==c.keyCode&&a.close()};a.searchKey=function(c){13==c.keyCode&&a.search(c)};a.searchResultHandler=
function(c,b){var e=a.editorData(b);a.fit.push({m:e.parent.map,b:c.bounds});setTimeout(a.fitLater,100);a.editorClick({id:b,latLng:c.location})};a.search=function(c){var b=a.editorData(c.target.data.id),e=b.parent.eli.mapSearchI.value,d=a.parsePos(e);0<d.length?a.searchResultHandler({bounds:new google.maps.LatLngBounds(new google.maps.LatLng(d[0][0],d[0][1]),new google.maps.LatLng(d[0][0],d[0][1])),location:new google.maps.LatLng(d[0][0],d[0][1])},c.target.data.id):b.parent.geocoder&&b.parent.geocoder.geocode({address:e},
function(b,d){d==google.maps.GeocoderStatus.OK&&a.searchResultHandler(b[0].geometry,c.target.data.id)})}}; 
